---
title: NAT & PAT
description: 네트워크의 기초인 NAT와 PAT에 대한 개념 정리
categories: [Computer Science, Network]
tags: [computer-science, network, nat, pat] # TAG names should always be lowercase
pin: false
math: true
mermaid: true
published: true
private: true # 커스텀해서 만든 것
image-path: /assets/img/computer-science/network/nat-pat # 이미지 공통 경로 변수
image:
  path: /assets/img/computer-science/network/nat-pat/nat-pat_1.png
  lqip: data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=
  alt: NAT(Network Adress Translation)'s Image
---

## NAT (Network Address Translation)의 개념

네트워크 주소 변환(Network Address Translation, `NAT`)란, `IP` 패킷의 출발지, 목적지 `IP` 주소와 `TCP`[^tcp] 또는 `UDP`[^udp]의 포트 번호를 재기록하면서 라우터와 같은 네트워크 장치를 통해 네트워크 통신을 하는 기술이다.

공유기는 이러한기술을 이용하여 내부 네트워크에 있는 여러 대의 PC들에게는 사설 `IP`를 할당하고, 해당 PC가 통신하려고 할 떄는 공인 `IP`로 변경해서 외부 네트워크와 통신하게 하는 역할을 수행한다.

### NAT 테이블

특정 출발지 `IP`와 특정 목적지 `IP`를 가진 네트워크 패킷이 `NAT`를 통해 변환되면 `NAT` 테이블에 기록하고 해당 패킷이 다시 돌아왔을 때 기록해둔 내용을 보고 원래의 출발지 경로로 패킷을 보내준다.

#### NAT 테이블의 간단한 원리 설명

![image_1][image_1]

{: .prompt-info}

> `192.168.1.2`가 `68.1.31.1`의 웹 사이트에 들어가고 싶다는 가정으로 시작

1.  `192.168.1.2`는 자신의 `IP` 주소와 목적지의 `IP` 주소, 웹 사이트 액세스 요청을 포함하는 패키지를 만들어서 보낸다.

    | Source IP Address | Destination IP Address | Requests |
    | :---------------: | :--------------------: | :------: |
    |   `192.168.1.2`   |      `68.1.31.1`       |   요청   |

2.  하지만 `68.1.31.1`은 웹 사이트를 `192.168.1.2`에게 보내줄 수 없는데, `192.168.1.2`와 같은 사설 `IP`가 어디있는지도 모르고, 사설 `IP`를 사용하는 모든 대상에게 데이터를 보낼 수 없기 때문이다.

    > 예를 들면, `지나가던 사람`(`68.1.31.1`)에게 다짜고짜 `홍길동`(`192.168.1.2`)에게 편지를 전해달라는 것과 같다.
    >
    > `홍길동`(`192.168.1.2`)이 어디있는지, 동명이인이 많을 것이고, 애초에 누군지도 모르는 상황인 것이다.

    | Source IP Address | Destination IP Address |       Responses        |
    | :---------------: | :--------------------: | :--------------------: |
    |    `68.1.31.1`    | `192.168.1.2` (몰?루)  | 응답 (누구?어디?맞나?) |

    - 결과적으로 웹 사이트 접속(요청/응답) 실패

3.  처음으로 돌아와서 `NAT` 라우더는 한 가지 기능을 추가로 수행하는데, `192.168.1.2`가 다시 한번 패키지를 만들어 전송하면 `NAT` 라우터는 이 패키지에서 수신 `IP`를 자신의 공인 `IP` 주소로 바꾼 후, `192.168.1.2`가 `68.1.31.1`로 접속하려 했다는 것을 기억하고 전달(테이블 생성)하게 된다.

    |            Source IP Address             | Destination IP Address | Requests |
    | :--------------------------------------: | :--------------------: | :------: |
    | `192.168.1.2` → <ins>101.89.101.12</ins> |      `68.1.31.1`       |   요청   |

    - `NAT` 라우터가 보관하는 테이블

      <table style="text-align: center; width: 100%;">
        <tr>
          <th colspan="3">NAT Table</th>
        </tr>
        <tr>
          <th>Private IP Address</th>
          <th>Source IP Address</th>
          <th>Destination IP Address</th>
        </tr>
        <tr>
          <td markdown="span">`192.168.1.2`</td>
          <td markdown="span"><ins>101.89.101.12</ins></td>
          <td markdown="span">`68.1.31.1`</td>
        </tr>
      </table>

4.  다시 `68.1.31.1`은 웹 사이트를 `101.89.101.12`로 보내면, 라우터는 테이블을 바탕으로 데이터를 `192.168.1.2`에게 보낼 수 있게 된다.

    | Source IP Address |  Destination IP Address  |  Responses  |
    | :---------------: | :----------------------: | :---------: |
    |    `68.1.31.1`    | <ins>101.89.101.12</ins> | 응답 (성공) |

## 참고 사이트

> [yang.log - NAT와 PAT에 대하여][ref_site_1]
>
> [IT Net Tech - 네트워크 기초 - NAT (Network Address Translation)][ref_site_2]
>
> [Inpa Dev - NAT(Network Address Translation) 이란 무엇인가?][ref_site_3]

---

[^tcp]: 전송 제어 프로토콜(Transmission Control Protocol, `TCP`)은 데이터와 패킷이 보내진 순서대로 전달하는 것을 보장해주면서 두 개의 호스트를 연결하고 데이터 스트림을 교환하게 해주는 중요한 네트워크 프로토콜이다.
[^udp]: 사용자 데이터그램 프로토콜 (User Datagram Protocol, `UDP`) 은 보안과 신뢰성보다 전송 속도와 효율성이 더 중요한 경우 데이터를 전송하기 위해 IP과 함께 오래 사용된 프로토콜이다.

<!-- 이미지 -->

[image_1]: {{page.image-path}}/nat-pat_1.png

<!-- 블로그 게시글 -->

[post-title]: {{site.url}}/posts/heap

<!-- 참고 사이트 -->

[ref_site_1]: https://velog.io/@yange/NAT%EC%99%80-PAT%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC
[ref_site_2]: https://daengsik.tistory.com/11
[ref_site_3]: https://inpa.tistory.com/entry/WEB-%F0%9F%8C%90-NAT-%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80
