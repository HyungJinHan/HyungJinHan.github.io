---
title: TCP VS UDP
description: TCPμ™€ UDPλ¥Ό λΉ„κµν•μ—¬ κ°λ…μ„ μ •λ¦¬
categories: [Computer Science, Network]
tags: [computer-science, network, udp, tcp] # TAG names should always be lowercase
pin: false
math: true
mermaid: true
published: true
private: true # μ»¤μ¤ν…€ν•΄μ„ λ§λ“  κ²ƒ
image-path: /assets/img/computer-science/network/tcp-udp # μ΄λ―Έμ§€ κ³µν†µ κ²½λ΅ λ³€μ
image:
  path: /assets/img/computer-science/network/tcp-udp/tcp-udp_3.png
  lqip: data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=
  alt: UDP(User Datagram Protocol) VS TCP(Transmission Control Protocol)
---

## Protocol(ν”„λ΅ν† μ½)?

{: .prompt-info}

> κ²°λ΅ μ„ λ¨Όμ € λ§ν•μλ©΄, `HTTP`, `IP`, `TCP`, `UDP` λ¨λ‘ ν”„λ΅ν† μ½μ΄λ©°, ν”„λ΅ν† μ½μ€ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ <ins>μ •λ³΄λ¥Ό κµν™ν•κΈ° μ„ν• μΌμΆ…μ λ©”μ‹μ§€ ν•μ‹μ κ·μΉ™</ins>μ΄λ‹¤.

<ins>ν”„λ΅ν† μ½(Protocol)</ins>μ€ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ •λ³΄λ¥Ό κµν™ν•  μ μλ„λ΅ ν•λ” <ins>λ©”μ‹μ§€ ν•μ‹μ— λ€ν• κ·μΉ™</ins>μ΄λΌκ³  λ³΄λ©΄ λλ‹¤.

μμ‹  νΈμ¤νΈκ°€ μ „μ†΅λ°›μ€ λ©”μ‹μ§€λ¥Ό μ΄ν•΄ν•κΈ° μ„ν•΄μ„λ” μ„¤κ³„λ κ·μΉ™μ— λ”°λΌ μ‘μ„±λ λ°μ΄ν„° ν•μ‹μ΄μ–΄μ•Ό ν•λ‹¤λ” κ²ƒμ΄λ‹¤.

μλ¥Ό λ“¤μ–΄ `HTTP` λ©”μ‹μ§€ ν—¤λ”λ„ κ²°κµ­ μΌμΆ…μ κ·μΉ™μ΄λ©°, `IP` μ£Όμ†μ μ«μλ„ κ·μΉ™μ΄λΌκ³  λ§ν•  μ μλ‹¤.

> `IP`μ κ·μΉ™μ„ κΉ¨λ” `256.256.256.256`κ³Ό κ°™μ€ ν•μ‹μ `IP` μ£Όμ†λ” μ΅΄μ¬ν•μ§€λ„ μ•μΌλ©°, μ‘λ™ν•μ§€λ„ μ•λ”λ‹¤.

## TCP (Transmission Control Protocol, μ „μ†΅ μ μ–΄ ν”„λ΅ν† μ½)

`IP`(Internet Protocol)κ°€ μΈν„°λ„· ν”„λ΅ν† μ½λ΅μ„ λ³µμ΅ν• <ins>μΈν„°λ„· λ§ μ†μ—μ„ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ ν†µμ‹ </ins>μ„ ν•  μ μκ² `IP` μ£Όμ†, ν¨ν‚·κ³Ό κ°™μ€ κ·μΉ™μ„ ν†µν•΄ ν†µμ‹ μ„ ν•λ” κ²ƒμ΄λΌλ©΄,

`TCP`(Transmission Control Protocol)λ” `IP` κ·μΉ™μΌλ΅λ§ ν†µμ‹ ν•κΈ°μ— λ¶€μ΅±ν•κ±°λ‚ λ¶μ•μ •ν•λ μ—¬λ¬ λ‹¨μ λ“¤(ν¨ν‚· μμ„κ°€ μ΄μƒν•κ±°λ‚ ν¨ν‚·μ΄ μ μ‹¤)μ„ μ»¤λ²„ν•΄, <ins>ν¨ν‚· μ „μ†΅μ„ μ μ–΄ν•μ—¬ μ‹ λΆ°μ„±μ„ λ³΄μ¦</ins>ν•λ” ν”„λ΅ν† μ½λ΅ λ³΄λ©΄ λλ‹¤.

`IP`μ™€ `TCP` λ‘ λ‹¤ ν”„λ΅ν† μ½μ΄μ§€λ§ μ΄ λ‘μ„ λ™μΌμ‹ν•λ©΄ μ•λλ”κ², μ΄ λ‘μ κ·μΉ™μ€ λ³„κ°μ΄λ‹¤.

`IP` κ·μΉ™μΌλ΅ μ¨μλ”λ€λ΅ λ©μ μ§€μ— λ„μ°©ν–μΌλ©΄ `TCP` κ·μΉ™μΌλ΅ μ¨μλ”λ€λ΅ μ¬λ°”λ¥΄κ² λ„μ°©ν–λ”μ§€, μ •ν™•ν λ„κµ¬μ—κ² μ „λ‹¬λμ–΄μ•Ό ν•λ”μ§€ λ“± ν•λ‚μ”© μ „λ¶€ λ”°μ§„λ‹¤κ³  μƒκ°ν•λ©΄ λλ‹¤.

> κ·Έλμ„ μ€ν–‰ μ—…λ¬΄λ‚ λ©”μΌκ³Ό κ°™μ€ λ°λ“μ‹ μμ‹ μκ°€ μ •λ³΄λ¥Ό λ°›μ•„μ•Ό ν•λ” μ‹ λΆ°μ„± μλ” ν†µμ‹ μ΄ ν•„μ”ν•  λ• μ‚¬μ©λλ‹¤.

### TCPμ μ „μ†΅ λ°μ΄ν„° ν¬μ¥

![image_4][image_4]

`TCP`μ μΈν„°λ„· ν†µμ‹ μ„ μ„ν• μ „μ†΅ λ°μ΄ν„° ν¬μ¥ λ°©μ‹μ€ μ„μ μ΄λ―Έμ§€μ™€ κ°™λ‹¤.

μ¶”κ°€μ μΈ μμ‹λ¥Ό λ“¤μλ©΄, νƒλ°° μν™”λ¬Όλ΅ λΉ„μ ν•  μ μλ‹¤.

`IP`λ” λ‹¨μν λ°°λ‹¬ μ£Όμ†μ§€λΌκ³  ν•λ‹¤λ©΄, `TCP`λ” μ΄ λ°°λ‹¬μ§€λ΅ λ¬Έμ μ—†μ΄ μ „μ†΅λλ„λ΅ νƒλ°° μ¤ν‹°μ»¤μ™€ κ°™μ€ μ—¬λ¬ λ¶€κ°€ μ •λ³΄λ“¤μ„ κ°€λ―Έν• κ²ƒμ΄λΌκ³  λ³Ό μ μλ‹¤.

λ‹¨μν λ©μ μ§€ λΏλ§ μ•„λ‹λΌ μμ„, κ²€μ¦, μ „μ†΅ μ μ–΄ μ •λ³΄κ°€ λ“¤μ–΄μμ–΄ `IP` μ£Όμ†μ§€λ΅λ§ λ¬Όν’μ„ λ°°λ‹¬ν•κΈ°μ—” λ¶μ•μ •ν• λ¶€λ¶„λ“¤μ„ ν™•μ‹¤ν•κ² μ»¤λ²„ν•μ—¬ λ°°λ‹¬ν’μ΄ λ©μ μ§€κΉμ§€ μ•μ „ν•κ² λ„μ°©ν•λ„λ΅ λ³΄μ¦ν•λ‹¤.

![image_5][image_5]

μ„μ μ΄λ―Έμ§€λ” μ „μ†΅ λ°μ΄ν„°κ°€ ν¬μ¥λλ” κ³Όμ •μ„ λ‚μ—΄ν• κ²ƒμ΄λ‹¤.

1. μ „μ†΅ λ°μ΄ν„°λ¥Ό `TCP` λ°©μ‹μΌλ΅ ν¬μ¥ν•λ‹¤.
2. ν¬μ¥ν• μ „μ†΅ λ°μ΄ν„°λ¥Ό `IP` λ°©μ‹μΌλ΅ ν¬μ¥ν•λ‹¤.
3. ν¬μ¥ν• μ „μ†΅ λ°μ΄ν„°λ¥Ό `Ethernet` λ°©μ‹μΌλ΅ ν¬μ¥ν•λ‹¤.
4. μΈν„°λ„·μ„ ν†µν•΄ μƒλ€ μ»΄ν“¨ν„° μ„λ²„μ— λ„λ‹¬ν•μ—¬ ν¬μ¥λ κ²ƒμ„ ν•λ‚μ”© ν’€λ©° μ „μ†΅ λ°μ΄ν„°λ¥Ό λ°›κ² λλ‹¤.

### TCPμ ν†µμ‹  ν™•μΈ

`TCP`λ” μ‹ λΆ°μ„± ν”„λ΅ν† μ½λ‹µκ², λ°μ΄ν„°λ¥Ό μ „μ†΅ν•κΈ° μ „μ— λ©μ μ§€κ°€ λ¬΄μ‚¬ν•μ§€λ¥Ό λ―Έλ¦¬ ν™•μΈν•κ³ , λ°μ΄ν„°μ μ „μ†΅μ΄ λλ‚ ν›„μ—λ„ λ‹¤μ‹ ν™•μΈ ν•΄μ£Όλ” κµ‰μ¥ν μΉμ ν•κ³  κΌΌκΌΌν• ν”„λ΅ν† μ½μ΄λ‹¤.

ν†µμ‹ μ„ μ‹μ‘ν•  λ•μ™€ μΆ…λ£ν•  λ• μ„λ΅ μ¤€λΉ„κ°€ λμ–΄μλ”μ§€λ¥Ό λ°λ“μ‹ λ―Έλ¦¬ λ¨Όμ € λ¬Όμ–΄λ³΄κ³  ν¨ν‚·μ„ μ „μ†΅ν•  μμ„λ¥Ό μ •ν•κ³  λ‚μ„μ•Ό λ³Έκ²©μ μΌλ΅ ν†µμ‹ μ„ μ‹μ‘ν•κΈ° λ•λ¬Έμ΄λ‹¤.

μ΄λ¬ν• κ³Όμ •μ΄ λ°”λ΅ <ins>3-Way Handshake</ins>μ™€ <ins>4-Way Handshake</ins> κ³Όμ •μ΄λ‹¤.

λ‘ λ‹¤ λ‘κ°™μ€ ν•Έλ“μ‰μ΄ν¬(Handshake)μ§€λ§, <ins class="blue">3-Way</ins>λ” ν†µμ‹ μ„ μ‹μ‘ν•  λ•, <ins class="red">4-Way</ins>λ” ν†µμ‹ μ΄ μΆ…λ£λ  λ• κ±°μΉλ” κ³Όμ •μ΄λΌλ” μ°¨μ΄λ§ μλ‹¤.

μ¦‰, ν• λ² ν†µμ‹ ν•λ”λ° ν•Έλ“μ‰μ΄ν¬λ¥Ό λ‘ λ² μ§„ν–‰ν•΄μ„ κ³Όν•  μ •λ„λ΅ μ‹ λΆ°μ„±μ„ λ³΄μ¥ν•λ‹¤κ³  μƒκ°ν•λ©΄ λλ‹¤.

![image_6][image_6]

μ„μ μ΄λ―Έμ§€μ—μ„ ν΄λΌμ΄μ–ΈνΈκ°€ μ²μ μ„λ²„μ™€ ν†µμ‹ μ„ ν•κΈ° μ„ν•΄ `TCP` μ—°κ²°μ„ μƒμ„±ν•  λ•, <ins>SYN</ins>μ™€ <ins>ACK</ins>λΌλ” ν¨ν‚·μ„ μ£Όκ³  λ°›μΌλ©°, ν†µμ‹ μ„ μΆ…λ£ν•λ” κ³Όμ •μ—μ„λ” <ins>FIN</ins>μ΄λΌλ” ν¨ν‚·μ„ μ£Όκ³  λ°›κ³  μλ” κ²ƒ λ³Ό μ μλ‹¤.

μ¦‰, ν¨ν‚· λ‚΄λ¶€μ— λ“¤μ–΄μλ” μΈμ¦ ν”λκ·Έ κ°’λ“¤μ„ ν™•μΈν•΄μ„ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ„λ΅ λ³΄λ‚Έ ν¨ν‚·μ μμ„μ™€ ν¨ν‚·μ„ μ λ€λ΅ λ°›μ•λ”μ§€λ¥Ό κ²€μ¦ν•λ” κ²ƒμ΄λ‹¤.

#### Flag μΆ…λ¥

| FLAG  | μ„¤λ…                                                                                                              |
| :---: | ----------------------------------------------------------------------------------------------------------------- |
| `SYN` | μ ‘μ† μ”μ²­μ„ ν•  λ• λ³΄λ‚΄λ” ν¨ν‚·μ„ λ§ν•λ‹¤.<br />`TCP` μ ‘μ† μ‹μ— κ°€μ¥ λ¨Όμ € λ³΄λ‚΄λ” ν¨ν‚·μ΄λ‹¤.                           |
| `ACK` | μƒλ€λ°©μΌλ΅λ¶€ν„° ν¨ν‚·μ„ λ°›μ€ λ’¤μ— μ λ°›μ•λ‹¤κ³  μ•λ ¤μ£Όλ” ν¨ν‚·μ„ λ§ν•λ‹¤.<br />λ‹¤λ¥Έ ν”λκ·Έμ™€ κ°™μ΄ μ¶λ ¥λλ” κ²½μ°λ„ μλ‹¤. |
| `PSH` | λ°μ΄ν„°λ¥Ό μ¦‰μ‹ λ©μ μ§€λ΅ λ³΄λ‚΄λΌλ” μλ―Έμ΄λ‹¤.                                                                         |
| `FIN` | μ ‘μ† μΆ…λ£λ¥Ό μ„ν• ν”λκ·Έμ΄λ‹¤.<br />μ΄ ν¨ν‚·μ„ λ³΄λ‚΄λ” κ³³μ΄ ν„μ¬ μ ‘μ†ν•κ³  μλ” κ³³κ³Ό μ ‘μ†μ„ λκ³ μ ν•  λ• μ‚¬μ©ν•λ‹¤.     |

#### 3-Way Handshakeμ κ³Όμ •

![image_7][image_7]

1. ν΄λΌμ΄μ–ΈνΈλ” μ ‘μ†μ„ μ”μ²­ν•λ” `SYN` ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤.

   μ΄λ•, ν΄λΌμ΄μ–ΈνΈλ” μ‘λ‹µμ„ κΈ°λ‹¤λ¦¬κΈ° μ„ν•΄ `SYN_SENT` μƒνƒλ΅ λ³€ν•λ‹¤.

2. `LISTEN` μƒνƒμ€λ μ„λ²„λ” `SYN` μ”μ²­μ„ λ°›μΌλ©΄, ν΄λΌμ΄μ–ΈνΈμ—κ² μ”μ²­μ„ μλ½ν•λ” `ACK` ν¨ν‚·κ³Ό `SYN` ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤.

   > μ„λ²„λ„ ν΄λΌμ΄μ–ΈνΈμ— μ ‘μ†ν•΄μ•Ό μ–‘λ°©ν–¥ ν†µμ‹ μ΄ λκΈ° λ•λ¬Έμ΄λ‹¤.

   κ·Έλ¦¬κ³  `SYN_RCVD(SYN_RECEIVED)` μƒνƒλ΅ λ³€ν•μ—¬ ν΄λΌμ΄μ–ΈνΈκ°€ `ACK` ν¨ν‚·μ„ λ³΄λ‚Ό λ•κΉμ§€ κΈ°λ‹¤λ¦¬κ² λλ‹¤.

3. ν΄λΌμ΄μ–ΈνΈλ” λ‹¤μ‹ μ„λ²„μ— `ACK` ν¨ν‚·μ„ λ³΄λ‚΄κ³ , μ΄ν›„μ— `ESTABLISHED` μƒνƒκ°€ λμ–΄ λ°μ΄ν„° ν†µμ‹ μ΄ κ°€λ¥ν•κ² λλ‹¤.

#### λ°μ΄ν„° ν†µμ‹  κ³Όμ •

![image_8][image_8]

1. `ESTABLISHED`λ μƒνƒμ—μ„ μ„λ²„μ—κ² λ°μ΄ν„°λ¥Ό λ³΄λ‚Έλ‹¤.
2. μ„λ²„λ” μ μ „μ†΅λ°›μ•λ‹¤κ³  `ACK` ν”λμ¤λ¥Ό λ„£μ–΄ μ‘λ‹µν•λ‹¤.
3. λ§μ•½ ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„λ΅λ¶€ν„° `ACK`λ¥Ό λ°›μ§€ λ»ν–λ‹¤λ©΄, μ λ€λ΅ μ†΅μ‹ ν•μ§€ λ»ν•κ±Έλ΅ νλ‹¨ν•κ³  λ°μ΄ν„°λ¥Ό μ¬μ „μ†΅ν•λ‹¤.

#### 4-Way Handshakeμ κ³Όμ •

![image_9][image_9]

1. μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ `TCP` μ—°κ²°μ΄ λμ–΄μλ” μƒνƒμ—μ„ ν΄λΌμ΄μ–ΈνΈκ°€ μ ‘μ†μ„ λκΈ° μ„ν•΄ `CLOSE()` ν•¨μλ¥Ό νΈμ¶ν•λ‹¤.

   κ·Έλ¬λ©΄ `FIN` ν”λκ·Έλ¥Ό λ³΄λ‚΄κ² λκ³ , ν΄λΌμ΄μ–ΈνΈλ” `FIN_WAIT1` μƒνƒλ΅ λ³€ν•λ‹¤.

2. μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈκ°€ `CLOSE()` ν•¨μλ¥Ό νΈμ¶ν• κ²ƒμ„ μ•κ²λκ³ , `CLOSE_WAIT` μƒνƒλ΅ λ°”κΎΌ ν›„, `ACK` ν”λκ·Έλ¥Ό μ „μ†΅ν•λ‹¤.

   λ§μΌ μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ λ³΄λ‚΄μ•Ό ν•λ” λ‚¨μ€ λ°μ΄ν„°κ°€ μμ„ κ²½μ°, μ΄ κ³Όμ •μ—μ„ λ‚λ¨Έμ§€λ¥Ό λ¨λ‘ μ „μ†΅μ‹ν‚¨λ‹¤.

3. `ACK`λ¥Ό λ°›μ€ ν΄λΌμ΄μ–ΈνΈλ” `FIN_WAIT2`λ΅ λ³€ν™λκ³ , μ΄λ–„ μ„λ²„λ” `CLOSE()` ν•¨μλ¥Ό νΈμ¶ν•κ³  `FIN` ν”λκ·Έλ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚Έλ‹¤.
4. μ„λ²„λ„ μ—°κ²°μ„ λ‹«μ•λ‹¤λ” μ‹ νΈλ¥Ό ν΄λΌμ΄μ–ΈνΈκ°€ μμ‹ ν•λ©΄, `ACK` ν”λκ·Έλ¥Ό λ³΄λ‚Έ ν›„ `TIME_WAIT` μƒνƒλ΅ μ „ν™λλ‹¤.

   μ΄ ν›„, λ¨λ“  κ²ƒμ΄ λλ‚λ©΄ `CLOSED` μƒνƒλ΅ λ³€ν™λλ‹¤.

### TCP ν†µμ‹  κ³Όμ • μ‹κ°μ μΌλ΅ ν™•μΈν•κΈ°

`TCP` ν•Έλ“μ‰μ΄ν¬ κ³Όμ •μ„ μ‹κ°μ μΌλ΅ ν™•μΈν•κΈ° μ„ν•΄ Linux λ…λ Ήμ–΄λ¥Ό ν†µν•΄ μ§„ν–‰ν•  μμ •μ΄λ‹¤.

> <https://www.wireshark.org/> β†’ μ™€μ΄μ–΄μƒ¤ν¬λΌλ” λ¬΄λ£ μ†ν”„νΈμ›¨μ–΄λ¥Ό μ‚¬μ©ν•΄μ„ ν™•μΈν•λ” λ°©λ²•λ„ μλ‹¤.

#### Linux tcpdumpλ΅ ν™•μΈν•κΈ°

`tcpdump`λ” Linux ν™κ²½μ—μ„ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ μ£Όκ³ λ°›λ” λ„¤νΈμ›ν¬ ν¨ν‚·μ„ `TCP layer`μ—μ„ μΊ΅μ³ν•μ—¬ λ©”μ‹μ§€λ¥Ό ν™•μΈν•  μ μλ” λ…λ Ήμ–΄λ΅, `UDP`λ„ ν™•μΈμ΄ κ°€λ¥ν•λ‹¤.

λ¨Όμ € μ•„λμ λ…λ Ήμ–΄λ¥Ό ν†µν•΄ `tcpdump` λ…λ Ήμ–΄λ¥Ό μ„¤μΉν•λ‹¤.

> ν•„μμ λ§¥ μ„Έν…μ κ²½μ°, Homebrewλ¥Ό ν†µν•΄ μ„¤μΉλ¥Ό μ§„ν–‰

```bash
# μ°λ¶„ν¬ μ„¤μΉ
apt install tcpdump

# CentOS μ„¤μΉ
yum install tcpdump

# Homebrew μ„¤μΉ
brew install tcpdump
```

μ„μ λ…λ Ήμ–΄λ¥Ό ν†µν•΄ μ„¤μΉκ°€ λλ‚¬λ‹¤λ©΄, μ•„λμ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•λ‹¤.

```bash
# μΈν„°λ„· ν†µμ‹ μ„ ν•λ” λ¨λ“  ν”„λ΅ν† μ½ κ°μ§€ λ…λ Ήμ–΄
sudo tcpdump -i en1 -c 10 # MacOSμ κ²½μ°, sudo
```

- `-i <interface>`
  : μΈν„°νμ΄μ¤ μ§€μ •
- `-c <count>`
  : μ§€μ •ν• μΉ΄μ΄νΈ ν¨ν‚·μ„ μμ‹ ν• ν›„ μΆ…λ£

> en1 λ“±μ λ„¤νΈμ›ν¬λ¥Ό μ•κ³  μ‹¶λ‹¤λ©΄ "μ΄ Macμ— κ΄€ν•μ—¬" β†’ "μ¶”κ°€ μ •λ³΄" β†’ λ§¨ μ•„λμ "μ‹μ¤ν… λ¦¬ν¬νΈ" β†’ "λ„¤νΈμ›ν¬"

μ„μ™€ κ°™μ΄ μµμ…μ„ μ§€μ •ν•΄μ„ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•λ©΄,

{: file="result"}

```bash
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on en1, link-type EN10MB (Ethernet), snapshot length 262144 bytes
```

μ„μ™€ κ°™μ΄ μΈν„°λ„· ν†µμ‹ μ„ κ°μ§€ν•λ” μƒνƒκ°€ λκ³ , μΈν„°λ„· ν†µμ‹ μ΄ κ°μ§€κ°€ λλ‹¤λ©΄,

{: file="result"}

```bash
14:34:53.316116 IP XXX.XX.X.X.mdns > mdns.mcast.net.mdns: 0*- [0q] 2/0/0 PTR _airplay._tcp.local., PTR _raop._tcp.local. (88)
```

μ„μ™€ κ°™μ€ λ„¤νΈμ›ν¬ ν†µμ‹  λ΅κ·Έλ¥Ό λ³Ό μ μλ‹¤.

κ·Έλ ‡λ‹¤λ©΄ μ§μ ‘ ν†µμ‹ μ„ μ§„ν–‰μ‹ν‚¤κ³  λ΅κ·Έλ¥Ό ν™•μΈν•΄λ³΄λ„λ΅ ν•λ‹¤.

1.  80λ² ν¬νΈλ΅ μ§€μ •ν•΄μ„ μΈν„°λ„· ν†µμ‹ μ„ `LISTEN` μƒνƒλ΅ μ‹¤ν–‰

    ```bash
    sudo tcpdump -i en1 port 80 # μ¶”κ°€μ μΌλ΅ ν¬νΈ 80λ²μΌλ΅ μ§€μ •
    ```

2.  μƒλ΅μ΄ ν„°λ―Έλ„μ„ μ—΄μ–΄μ„ μ„μλ΅ 80λ² ν¬νΈμ— λ„¤νΈμ›ν¬ ν†µμ‹ μ„ μ§„ν–‰

    ```bash
    echo "Hello World" | nc naver.com 80
    ```

    {: file="result"}

    ```bash
    HTTP/1.1 400 Bad request
    Content-length: 90
    Cache-Control: no-cache
    Connection: close
    Content-Type: text/html

    <html><body><h1>400 Bad request</h1>
    Your browser sent an invalid request.
    </body></html>
    ```

    {: .prompt-warning}

    > μ΅΄μ¬ν•μ§€ μ•λ” μ„λ²„λ΅ λ‹Ήμ—°ν ν†µμ‹  μ—λ¬

3.  μΈν„°λ„· ν†µμ‹ μ„ `LISTEN` μƒνƒλ΅ μ μ§€ν•κ³  μλ” ν„°λ―Έλ„ ν™•μΈ

    {: file="result"}

    ```bash
    14:47:51.551763 IP 172.30.1.45.54147 > 223.130.200.219.http: Flags [S], seq 1493362503, win 65535, options [mss 1460,nop,wscale 6,nop,nop,TS val 3305467768 ecr 0,sackOK,eol], length 0
    14:47:51.564850 IP 223.130.200.219.http > 172.30.1.45.54147: Flags [S.], seq 1123520104, ack 1493362504, win 28960, options [mss 1440,sackOK,TS val 222617396 ecr 3305467768,nop,wscale 11], length 0
    14:47:51.565151 IP 172.30.1.45.54147 > 223.130.200.219.http: Flags [.], ack 1, win 2052, options [nop,nop,TS val 3305467782 ecr 222617396], length 0
    14:47:51.565245 IP 172.30.1.45.54147 > 223.130.200.219.http: Flags [P.], seq 1:13, ack 1, win 2052, options [nop,nop,TS val 3305467782 ecr 222617396], length 12: HTTP
    14:47:51.565267 IP 172.30.1.45.54147 > 223.130.200.219.http: Flags [F.], seq 13, ack 1, win 2052, options [nop,nop,TS val 3305467782 ecr 222617396], length 0
    14:47:51.578659 IP 223.130.200.219.http > 172.30.1.45.54147: Flags [P.], seq 1:208, ack 14, win 15, options [nop,nop,TS val 222617407 ecr 3305467782], length 207: HTTP: HTTP/1.1 400 Bad request
    14:47:51.578661 IP 223.130.200.219.http > 172.30.1.45.54147: Flags [F.], seq 208, ack 14, win 15, options [nop,nop,TS val 222617407 ecr 3305467782], length 0
    14:47:51.578941 IP 172.30.1.45.54147 > 223.130.200.219.http: Flags [.], ack 208, win 2049, options [nop,nop,TS val 3305467795 ecr 222617407], length 0
    14:47:51.579090 IP 172.30.1.45.54147 > 223.130.200.219.http: Flags [.], ack 209, win 2049, options [nop,nop,TS val 3305467795 ecr 222617407], length 0
    ```

- `172.30.1.45.54147`
  : ν΄λΌμ΄μ–ΈνΈ `IP`
- `223.130.200.219.http`
  : μ„λ²„ `IP` (`http` -> `80`)
- `172.30.1.45.54147 > 223.130.200.219.http`
  : "ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ²" β†’ "λ³΄λ‚΄λ” μ½ > λ°›λ” μ½"
- `Flags  [S, S., ., P., F.]`
  : μ•μ„ μ„¤λ…ν• ν”λκ·Έλ¥Ό μλ―Έ

  | Flag | μ΄λ¦„      |
  | ---- | --------- |
  | `S`  | `SYN`     |
  | `S.` | `SYN-ACK` |
  | `.`  | `ACK`     |
  | `P`  | `PSH`     |
  | `F`  | `FIN`     |

#### 3-Way Handshake κ³Όμ •

![image_10][image_10]

1. ν΄λΌμ΄μ–ΈνΈ(`172.30.1.45`) β†’ μ„λ²„(`223.130.200.219`) : <ins>[SYN]</ins>, <ins>[S]</ins>
2. μ„λ²„(`223.130.200.219`) β†’ ν΄λΌμ΄μ–ΈνΈ(`172.30.1.45`) : <ins>[SYN-ACK]</ins>, <ins>[S.]</ins>
3. ν΄λΌμ΄μ–ΈνΈ(`172.30.1.45`) β†’ μ„λ²„(`223.130.200.219`) : <ins>[ACK]</ins>, <ins>[.]</ins>

{: .prompt-info}

> `seq` λ²νΈλ” μμ„ λ²νΈλ΅μ¨, ν¨ν‚·μ μ „λ‹¬ μμ„λ¥Ό μ‹λ³„ν•λ”λ° μ‚¬μ©λλ” κ°’μ΄λ‹¤.
>
> μ΄μμ²΄μ μ— μν•΄μ„ λλ¤ν•κ² μƒμ„±λμ„ `SYN` ν¨ν‚·μ— λ‹΄κ²¨μ„ λ³΄λ‚΄μ§€λ©°, μ΄λ¥Ό λ°›μ€ μ„λ²„μ—λ” λ™κΈ°ν™”μ— λ€ν• λ‹µμ‹ μΌλ΅ `seq` λ²νΈλ¥Ό +1 μ¦κ°€μ‹ν‚¤κ³  `ack`μ— λ‹΄μ•„ μ‘λ‹µν•λ‹¤.

#### λ°μ΄ν„° ν†µμ‹  κ³Όμ •

![image_11][image_11]

1. ν΄λΌμ΄μ–ΈνΈ(`172.30.1.45`) β†’ μ„λ²„(`223.130.200.219`) : <ins>[PSH-ACK]</ins>, <ins>[P.]</ins>
2. ν΄λΌμ΄μ–ΈνΈ(`172.30.1.45`) β†’ μ„λ²„(`223.130.200.219`) : <ins>[FIN-ACK]</ins>, <ins>[F.]</ins>
   - μμƒν•΄λ³΄μλ©΄, μ„λ²„ μΈ΅μ—μ„ ν†µμ‹  μ¤λ¥λ΅ μΈν•΄ `PSH-ACK` μ΄ν›„μ— λ°”λ΅ `FIN-ACK`λ΅ ν†µμ‹ μ„ μΆ…λ£μ‹ν‚¨ λ“― ν•λ‹¤. (λ” μ•μ•„λ³΄κ³  λ‹µμ„ μ°Ύμ„ μμ •)
3. μ„λ²„(`223.130.200.219`) β†’ ν΄λΌμ΄μ–ΈνΈ(`172.30.1.45`) : <ins>[PSH-ACK]</ins>, <ins>[P.]</ins>
   - ν•΄λ‹Ή λ΅κ·Έμ μ •λ³΄λ΅ `HTTP: HTTP/1.1 400 Bad request` λ΅κ·Έκ°€ μλ” κ²ƒμΌλ΅ λ΄μ„, μ„λ²„ μΈ΅μ—μ„ μ—λ¬λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² `PSH-ACK`ν• μ‘μ—…μΌλ΅ λ³΄μΈλ‹¤. (λ” μ•μ•„λ³΄κ³  λ‹µμ„ μ°Ύμ„ μμ •)
4. μ„λ²„(`223.130.200.219`) β†’ ν΄λΌμ΄μ–ΈνΈ(`172.30.1.45`) : <ins>[FIN-ACK]</ins>, <ins>[F.]</ins>

#### 4-Way Handshake κ³Όμ •

![image_12][image_12]

μµμΆ…μ μΌλ΅ μ„μ—μ„ μ„¤λ…ν• κ²ƒμ²λΌ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ ν†µμ‹ μ€ μ΄λ―Έ `FIN-ACK`λ¥Ό ν†µν•΄ λκΈ΄ μƒν™©μ΄λ―€λ΅ μ¶”κ°€μ μΈ ν†µμ‹ μ— λ€ν• ν”λκ·Έκ°€ μ΅΄μ¬ν•μ§€ μ•λ”λ‹¤.

μ¦‰, ν†µμ‹ μ— λ€ν• ν”λκ·Έκ°€ μ—†κΈ° λ•λ¬Έμ— `.`μ„ ν†µν• Placeholderκ°€ μ°νλ‹¤. (μ¶”?μΈ΅, λ” μ•μ•„λ³΄κ³  λ‹µμ„ μ°Ύμ„ μμ •)

1. ν΄λΌμ΄μ–ΈνΈ(`172.30.1.45`) β†’ μ„λ²„(`223.130.200.219`) : <ins>[ACK]</ins>, <ins>[.]</ins>

### TCPμ μ „μ†΅ μ μ–΄ κΈ°λ²•

β οΈ μ—¬κΈ°μ„λ¶€ν„°λ” μ¶”κ°€μ μΌλ΅ μ‘μ„± μμ •

## μ°Έκ³  μ‚¬μ΄νΈ

> [Inpa Dev - π μ•„μ§λ„ λ¨νΈν• TCP / UDP κ°λ… β“ μ‰½κ² μ΄ν•΄ν•μ][ref_site_1]
>
> [Z.com Cloud - So sΓ΅nh chi tiαΊΏt TCP vΓ  UDP: Chα»n giao thα»©c nΓ o tα»‘t nhαΊ¥t?][ref_site_2]

<!-- μ΄λ―Έμ§€ -->

[image_1]: {{page.image-path}}/tcp-udp_1.png
[image_2]: {{page.image-path}}/tcp-udp_2.png
[image_3]: {{page.image-path}}/tcp-udp_3.png
[image_4]: {{page.image-path}}/tcp-udp_4.png
[image_5]: {{page.image-path}}/tcp-udp_5.png
[image_6]: {{page.image-path}}/tcp-udp_6.png
[image_7]: {{page.image-path}}/tcp-udp_7.png
[image_8]: {{page.image-path}}/tcp-udp_8.png
[image_9]: {{page.image-path}}/tcp-udp_9.png
[image_10]: {{page.image-path}}/tcp-udp_10.png
[image_11]: {{page.image-path}}/tcp-udp_11.png
[image_12]: {{page.image-path}}/tcp-udp_12.png

<!-- λΈ”λ΅κ·Έ κ²μ‹κΈ€ -->

[tcp-udp]: {{site.url}}/posts/tcp-udp

<!-- μ°Έκ³  μ‚¬μ΄νΈ -->

[ref_site_1]: https://inpa.tistory.com/entry/NW-%F0%9F%8C%90-%EC%95%84%EC%A7%81%EB%8F%84-%EB%AA%A8%ED%98%B8%ED%95%9C-TCP-UDP-%EA%B0%9C%EB%85%90-%E2%9D%93-%EC%89%BD%EA%B2%8C-%EC%9D%B4%ED%95%B4%ED%95%98%EC%9E%90
[ref_site_2]: https://cloud.z.com/vn/news/udp/
